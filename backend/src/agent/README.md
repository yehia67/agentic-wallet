# Agent Architecture

The agent architecture is designed to process user intents through a multi-step workflow that includes planning, research, and judgment phases, with optional wallet operations.

## Components

### Agent Service

The main service that orchestrates the agent workflow. It:

1. Processes user messages
2. Coordinates the planning, research, and judgment phases
3. Extracts wallet operations from approved plans
4. Executes wallet operations when needed

### Tools

The agent uses various tools to perform specific tasks:

- **Plan Generator Tool**: Creates and refines plans based on user intent
- **Wallet Agent Tool**: Executes wallet operations and analyzes transaction safety

See the [tools README](./tools/README.md) for more details.

### Types

The agent uses several types to represent its state and data:

- `AgentContext`: Represents the current state of the agent workflow
- `PlanningResponse`: Represents a plan generated by the planning agent
- `ResearchResponse`: Represents research findings from the research agent
- `JudgeResponse`: Represents the judgment of a plan by the judge agent
- `WalletAction`: Represents a wallet operation to be executed
- `WalletResult`: Represents the result of a wallet operation

### Workflow

The agent workflow consists of the following steps:

1. **Planning**: Generate a plan based on user intent
2. **Research**: Gather relevant information to inform the plan
3. **Judgment**: Evaluate the plan based on the research
4. **Wallet Operations**: If the plan is approved and includes wallet operations, execute them

The workflow may cycle through multiple iterations of planning, research, and judgment until a plan is approved or a maximum number of cycles is reached.

## Usage

The agent can be used through the `AgentController`, which exposes an endpoint for processing user messages:

```typescript
POST /agent/message
{
  "message": "I want to check my wallet balance",
  "preferences": {
    "riskTolerance": "low"
  }
}
```

The response will include the plan, research, judgment, and any wallet operation results:

```json
{
  "message": "Plan approved! Here are the details:",
  "plan": { ... },
  "research": { ... },
  "decision": { ... },
  "wallet": { ... },
  "status": "completed"
}
```
